<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>我们的小秘密 💑</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <!-- PeerJS for 视频通话 -->
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- 首次设置界面 -->
    <div id="setupScreen" style="display: none;">
        <div class="container">
            <div class="setup-card">
                <div class="setup-icon">🔐</div>
                <div class="setup-title">设置你们的专属ID</div>
                <div class="setup-text">
                    输入一个独特的ID，你和她都用这个ID，<br>
                    数据就能实时同步啦！💕
                </div>
                
                <input 
                    type="text" 
                    id="coupleIdInput" 
                    class="couple-id-input" 
                    placeholder="例如：xiaoming-xiaohong"
                    maxlength="50"
                >
                
                <button class="btn" onclick="saveCoupleId()">
                    💝 开始使用
                </button>
                
                <div class="note">
                    💡 提示：<br>
                    • 这个ID只有你们知道<br>
                    • 两个人要用<strong>同一个ID</strong>才能同步<br>
                    • 建议使用字母+数字组合，更安全<br>
                    • 配置后可以随时更改
                </div>
            </div>
        </div>
    </div>

    <!-- 主应用界面 -->
    <div id="mainApp">
        <div class="container">
            <!-- 头部 -->
            <div class="glass-card">
                <div class="header">
                    <h1>💑 我们的小秘密 💑</h1>
                    <div class="sync-status">
                        <div class="sync-dot"></div>
                        <span>实时同步中</span>
                    </div>
                    <div class="online-status" id="onlineStatus">
                        <div class="online-dot"></div>
                        <span>正在检测对方状态...</span>
                    </div>
                </div>

                <!-- 标签页 -->
                <div class="tabs">
                    <div class="tab active" data-tab="period">
                        🌸 生理期
                    </div>
                    <div class="tab" data-tab="interactions">
                        💕 互动
                    </div>
                    <div class="tab" data-tab="messages">
                        💬 留言
                    </div>
                    <div class="tab" data-tab="video">
                        📹 视频
                    </div>
                </div>

                <!-- 生理期标签页 -->
                <div id="period" class="tab-content active">
                    <!-- 当前状态卡片 -->
                    <div class="period-status-card" id="periodStatusCard">
                        <div class="status-icon-container" id="statusIconContainer">
                            <!-- SVG图标将在这里动态插入 -->
                        </div>
                        <div class="status-title" id="statusTitle">加载中...</div>
                        <div class="status-text" id="statusText">正在计算...</div>
                        <div class="status-days" id="statusDays"></div>
                    </div>

                    <!-- 快速操作 -->
                    <div class="quick-actions">
                        <button class="action-btn primary" onclick="recordPeriodStart()">
                            <span class="btn-icon">📅</span>
                            <span class="btn-text">记录经期开始</span>
                        </button>
                        <button class="action-btn secondary" onclick="recordPeriodEnd()">
                            <span class="btn-icon">✓</span>
                            <span class="btn-text">记录经期结束</span>
                        </button>
                    </div>

                    <!-- 周期设置 -->
                    <div class="cycle-setting">
                        <div class="setting-label">
                            <span>平均周期</span>
                            <span class="setting-value" id="cycleValue">28天</span>
                        </div>
                        <input 
                            type="range" 
                            id="cycleSlider" 
                            min="21" 
                            max="35" 
                            value="28" 
                            class="cycle-slider"
                            oninput="updateCycle(this.value)"
                        >
                        <div class="slider-labels">
                            <span>21天</span>
                            <span>35天</span>
                        </div>
                    </div>

                    <!-- 历史记录 -->
                    <div class="section">
                        <h3 class="section-title">📊 历史记录</h3>
                        <div id="periodHistory" class="history-list">
                            <div class="empty-state">
                                <div class="empty-icon">📝</div>
                                <div>还没有记录，点击上方按钮开始记录</div>
                            </div>
                        </div>
                    </div>

                    <!-- 贴心提醒 -->
                    <div class="section">
                        <h3 class="section-title">💝 贴心提醒</h3>
                        <div class="care-tips" id="careTips">
                            <!-- 动态生成 -->
                        </div>
                    </div>
                </div>

                <!-- 互动标签页 -->
                <div id="interactions" class="tab-content">
                    <h3 class="section-title">💝 情侣互动</h3>
                    
                    <div class="interaction-grid">
                        <div class="interaction-btn" data-type="kiss" data-label="💋 飞吻">
                            <div class="emoji">💋</div>
                            <div class="label">飞吻</div>
                        </div>
                        <div class="interaction-btn" data-type="hug" data-label="🤗 抱抱">
                            <div class="emoji">🤗</div>
                            <div class="label">抱抱</div>
                        </div>
                        <div class="interaction-btn" data-type="love" data-label="❤️ 爱你">
                            <div class="emoji heartbeat">❤️</div>
                            <div class="label">爱你</div>
                        </div>
                        <div class="interaction-btn" data-type="miss" data-label="🥺 想你">
                            <div class="emoji">🥺</div>
                            <div class="label">想你</div>
                        </div>
                        <div class="interaction-btn" data-type="rose" data-label="🌹 送花">
                            <div class="emoji">🌹</div>
                            <div class="label">送花</div>
                        </div>
                        <div class="interaction-btn" data-type="gift" data-label="🎁 礼物">
                            <div class="emoji">🎁</div>
                            <div class="label">礼物</div>
                        </div>
                        <div class="interaction-btn" data-type="breakfast" data-label="🍳 做早餐">
                            <div class="emoji">🍳</div>
                            <div class="label">做早餐</div>
                        </div>
                        <div class="interaction-btn" data-type="massage" data-label="💆 按摩">
                            <div class="emoji">💆</div>
                            <div class="label">按摩</div>
                        </div>
                        <div class="interaction-btn" data-type="movie" data-label="🎬 看电影">
                            <div class="emoji">🎬</div>
                            <div class="label">看电影</div>
                        </div>
                        <div class="interaction-btn" data-type="walk" data-label="🚶 散步">
                            <div class="emoji">🚶</div>
                            <div class="label">散步</div>
                        </div>
                        <div class="interaction-btn" data-type="coffee" data-label="☕ 喝咖啡">
                            <div class="emoji">☕</div>
                            <div class="label">喝咖啡</div>
                        </div>
                        <div class="interaction-btn" data-type="sleep" data-label="😴 晚安">
                            <div class="emoji">😴</div>
                            <div class="label">晚安</div>
                        </div>
                    </div>

                    <h3 class="section-title" style="margin-top: 30px;">🎯 快速关怀</h3>
                    
                    <div class="interaction-grid">
                        <div class="interaction-btn" data-type="water" data-label="💧 多喝水">
                            <div class="emoji">💧</div>
                            <div class="label">多喝水</div>
                        </div>
                        <div class="interaction-btn" data-type="rest" data-label="😌 休息下">
                            <div class="emoji">😌</div>
                            <div class="label">休息下</div>
                        </div>
                        <div class="interaction-btn" data-type="eat" data-label="🍱 记得吃饭">
                            <div class="emoji">🍱</div>
                            <div class="label">吃饭</div>
                        </div>
                        <div class="interaction-btn" data-type="weather" data-label="🌡️ 注意天气">
                            <div class="emoji">🌡️</div>
                            <div class="label">天气</div>
                        </div>
                        <div class="interaction-btn" data-type="safety" data-label="🏠 注意安全">
                            <div class="emoji">🏠</div>
                            <div class="label">安全</div>
                        </div>
                        <div class="interaction-btn" data-type="cheer" data-label="💪 加油">
                            <div class="emoji">💪</div>
                            <div class="label">加油</div>
                        </div>
                    </div>

                    <!-- 最近互动记录 -->
                    <div style="margin-top: 30px;">
                        <h3 class="section-title">📊 最近互动</h3>
                        <div id="recentInteractions" class="recent-list">
                            暂无互动记录
                        </div>
                    </div>
                </div>

                <!-- 留言标签页 -->
                <div id="messages" class="tab-content">
                    <div class="message-input-container">
                        <input 
                            type="text" 
                            id="messageInput" 
                            class="message-input" 
                            placeholder="给ta留个言吧~ 💕"
                            maxlength="200"
                        >
                        <button class="send-btn" onclick="sendMessage()">
                            发送
                        </button>
                    </div>

                    <div class="messages-list" id="messagesList">
                        <div class="empty-state">
                            <div class="empty-icon">💌</div>
                            <div>还没有留言，快来说点什么吧~</div>
                        </div>
                    </div>
                </div>

                <!-- 视频通话标签页 -->
                <div id="video" class="tab-content">
                    <div class="video-container" id="videoContainer" style="display: none;">
                        <video id="remoteVideo" class="video-main" autoplay playsinline></video>
                        <video id="localVideo" class="video-small" autoplay playsinline muted></video>
                        
                        <div class="video-controls">
                            <button class="video-btn mute" onclick="toggleMute()" title="静音/取消静音">
                                🎤
                            </button>
                            <button class="video-btn hangup" onclick="hangUp()" title="挂断">
                                📞
                            </button>
                        </div>
                    </div>

                    <div id="callInterface">
                        <div class="call-ui">
                            <div class="call-icon">📹</div>
                            <div class="call-title">视频通话</div>
                            <div class="call-text">
                                点击下面的按钮开始视频通话<br>
                                对方会收到通话请求
                            </div>
                            <button class="video-btn call" onclick="startCall()">
                                📞
                            </button>
                            <div class="call-note">
                                提示：需要允许摄像头和麦克风权限
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 设置按钮 -->
                <div style="margin-top: 30px; text-align: center;">
                    <button class="btn btn-secondary" onclick="showSettings()">
                        ⚙️ 设置
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 设置弹窗 -->
    <div id="settingsModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>⚙️ 设置</h3>
                <button class="close-btn" onclick="closeSettings()">✕</button>
            </div>
            <div class="modal-body">
                <div class="setting-item">
                    <div class="setting-label">专属ID</div>
                    <div class="setting-value" id="currentCoupleId"></div>
                </div>
                <div class="setting-item">
                    <div class="setting-label">用户ID</div>
                    <div class="setting-value" id="currentUserId"></div>
                </div>
                <button class="btn btn-danger" onclick="resetCoupleId()">
                    🔄 更改专属ID
                </button>
            </div>
        </div>
    </div>

    <!-- 编辑经期记录弹窗 -->
    <div id="editPeriodModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>✏️ 编辑记录</h3>
                <button class="close-btn" onclick="closeEditPeriod()">✕</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">开始日期</label>
                    <input 
                        type="date" 
                        id="editStartDate" 
                        class="date-input"
                    >
                </div>
                <div class="form-group">
                    <label class="form-label">结束日期</label>
                    <input 
                        type="date" 
                        id="editEndDate" 
                        class="date-input"
                    >
                    <div class="form-note">如果经期还未结束，可以不填结束日期</div>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-primary" onclick="saveEditedPeriod()">
                        💾 保存修改
                    </button>
                    <button class="btn btn-danger" onclick="deleteCurrentPeriod()">
                        🗑️ 删除记录
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
